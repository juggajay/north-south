---
phase: 05-finishes-pricing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/seed.ts
  - convex/products/modules.ts
autonomous: true

must_haves:
  truths:
    - "All prices in database are stored as integers (cents)"
    - "Modules can be queried from Convex"
  artifacts:
    - path: "convex/seed.ts"
      provides: "Seed data with cents-based pricing"
      contains: "pricePerUnit: 8900"
    - path: "convex/products/modules.ts"
      provides: "Module queries for pricing"
      exports: ["list", "getByCode"]
  key_links:
    - from: "convex/products/modules.ts"
      to: "convex/schema.ts"
      via: "query on modules table"
      pattern: 'query\\("modules"\\)'
---

<objective>
Migrate seed data to cents-based pricing and create modules query API.

Purpose: Research identified that storing prices as integers (cents) prevents JavaScript floating-point errors. Current seed data stores prices in dollars (e.g., 89 instead of 8900). This plan migrates all pricing to cents and adds the missing modules.list query needed by the pricing hook.

Output: Updated seed data with cents-based pricing, new modules query file.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-finishes-pricing/05-RESEARCH.md

@convex/seed.ts
@convex/schema.ts
@convex/products/materials.ts
@convex/products/hardware.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate seed data to cents-based pricing</name>
  <files>convex/seed.ts</files>
  <action>
Update all pricePerUnit, pricePerDoor, pricePerUnit, and basePrice values to cents (multiply by 100).

Current dollars -> cents conversion needed:
- Materials: 89 -> 8900, 75 -> 7500
- Hardware: 12 -> 1200, 18 -> 1800, 65 -> 6500, 68 -> 6800, 72 -> 7200, 145 -> 14500, 890 -> 89000, 185 -> 18500
- Door profiles: 0 -> 0, 25 -> 2500, 35 -> 3500, 55 -> 5500
- Products basePrice: 5000 -> 500000, 2500 -> 250000, 1500 -> 150000, 3000 -> 300000
- Base modules: 280 -> 28000, 350 -> 35000, 420 -> 42000, 380 -> 38000, 580 -> 58000, 520 -> 52000, 890 -> 89000
- Overhead modules: 220 -> 22000, 280 -> 28000, 340 -> 34000, 320 -> 32000, 420 -> 42000
- Addons: 45 -> 4500, 35 -> 3500, 120 -> 12000, 85 -> 8500, 165 -> 16500, 195 -> 19500, 8 -> 800

Add comment at top of seed data explaining: "// All prices in cents (e.g., 8900 = $89.00)"

Note: priceVariance remains as percentage (5 = 5%), not converted.
  </action>
  <verify>
Verify that:
1. All pricePerUnit values are now 100x larger (e.g., materials show 8900 not 89)
2. Comment exists explaining cents storage
3. priceVariance values unchanged (still 5)

Run: `grep -n "pricePerUnit: 89" convex/seed.ts` should return 0 results
Run: `grep -n "pricePerUnit: 8900" convex/seed.ts` should return material results
  </verify>
  <done>All monetary values in seed.ts are stored as integers representing cents, with explanatory comment.</done>
</task>

<task type="auto">
  <name>Task 2: Create modules query API</name>
  <files>convex/products/modules.ts</files>
  <action>
Create new file convex/products/modules.ts with query functions following the pattern in materials.ts and hardware.ts:

1. `list` - Get all active modules (sorted by sortOrder)
2. `getByCode` - Get single module by code
3. `listByCategory` - Filter by category (base, overhead, tall, corner)

Use existing patterns:
- Filter by active === true
- Use withIndex for by_code and by_category indexes
- Return full module objects including pricePerUnit (in cents)

The schema already has modules table with indexes by_code, by_category.
  </action>
  <verify>
Run: `npx convex dev --once` to verify no TypeScript errors
Check that convex/_generated/api.d.ts includes products.modules.list
  </verify>
  <done>convex/products/modules.ts exists with list, getByCode, listByCategory queries. Convex generates API types successfully.</done>
</task>

<task type="auto">
  <name>Task 3: Re-seed database with updated pricing</name>
  <files>N/A - Convex CLI operation</files>
  <action>
The database currently has dollar-based pricing. Need to clear and re-seed with cents.

Steps:
1. Clear existing seed data by running a mutation that deletes all materials, hardware, doorProfiles, products, modules, addons, styles
2. Re-run the seed mutation to populate with cents-based data

Create a temporary clearSeed mutation in seed.ts:
```typescript
export const clearSeed = mutation({
  args: {},
  handler: async (ctx) => {
    // Delete all seeded data
    const tables = ['materials', 'hardware', 'doorProfiles', 'products', 'modules', 'addons', 'styles']
    for (const table of tables) {
      const docs = await ctx.db.query(table as any).collect()
      for (const doc of docs) {
        await ctx.db.delete(doc._id)
      }
    }
    return { success: true, message: "Seed data cleared" }
  },
})
```

Run clearSeed, then runSeed via Convex dashboard or CLI.

After verification, the clearSeed mutation can remain (useful for future reseeds) or be removed.
  </action>
  <verify>
Query materials via Convex dashboard and verify pricePerUnit shows cents values (e.g., 8900 for Natural Oak Woodmatt instead of 89).

Run in Convex dashboard:
- Query materials table, check first record pricePerUnit
- Query modules table, verify list returns results with cents pricing
  </verify>
  <done>Database contains cents-based pricing for all product catalog items.</done>
</task>

</tasks>

<verification>
1. Grep for old dollar values in seed.ts - should find none
2. Grep for new cents values in seed.ts - should find all
3. Convex generates types for products.modules API
4. Database contains cents-based pricing (verified via dashboard query)
</verification>

<success_criteria>
- [ ] All seed data prices converted to cents (Ã—100)
- [ ] Comment explains cents storage convention
- [ ] convex/products/modules.ts exists with list, getByCode queries
- [ ] Convex compiles without errors
- [ ] Database re-seeded with cents-based values
</success_criteria>

<output>
After completion, create `.planning/phases/05-finishes-pricing/05-01-SUMMARY.md`
</output>
