---
phase: 04-3d-configurator-core
plan: 04
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/wizard/WizardShell.tsx
  - src/components/wizard/StepIndicator.tsx
  - src/components/wizard/StepNavigation.tsx
  - src/components/wizard/StepDimensions.tsx
  - src/components/ui/slider-control.tsx
autonomous: true

must_haves:
  truths:
    - "Wizard shell displays 4 steps with progress indicator"
    - "Next/Back buttons navigate between steps"
    - "Step 1 shows dimension sliders"
    - "Validation prevents advancing without valid dimensions"
  artifacts:
    - path: "src/components/wizard/WizardShell.tsx"
      provides: "Wizard container with step content"
      exports: ["WizardShell"]
    - path: "src/components/wizard/StepIndicator.tsx"
      provides: "Step progress indicator"
      exports: ["StepIndicator"]
    - path: "src/components/wizard/StepNavigation.tsx"
      provides: "Next/Back navigation buttons"
      exports: ["StepNavigation"]
    - path: "src/components/wizard/StepDimensions.tsx"
      provides: "Step 1 dimension controls"
      exports: ["StepDimensions"]
  key_links:
    - from: "src/components/wizard/WizardShell.tsx"
      to: "src/stores/useWizardStore.ts"
      via: "useWizardStore hook"
      pattern: "useWizardStore\\("
    - from: "src/components/wizard/StepDimensions.tsx"
      to: "src/stores/useCabinetStore.ts"
      via: "dimension setters"
      pattern: "setDimension\\("
---

<objective>
Create the 4-step wizard navigation shell and Step 1 (Dimensions) with sliders.

Purpose: Establishes the wizard flow that users navigate through to configure their cabinet.
Output: Wizard shell with step indicator, navigation buttons, and dimension controls for Step 1.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-3d-configurator-core/04-CONTEXT.md
@src/stores/useWizardStore.ts
@src/stores/useCabinetStore.ts
@src/components/ui/slider.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StepIndicator and StepNavigation components</name>
  <files>
    src/components/wizard/StepIndicator.tsx
    src/components/wizard/StepNavigation.tsx
  </files>
  <action>
Create `src/components/wizard/StepIndicator.tsx`:

Per CONTEXT.md: Step indicator placement is Claude's discretion. Place at top for always-visible progress.

Display 4 steps: Dimensions, Layout, Finishes, Review
- Show current step highlighted
- Show completed steps with checkmark
- Show locked steps as disabled (per unlocking progression logic)

```typescript
import { useWizardStore } from '@/stores/useWizardStore'
import { Check } from 'lucide-react'
import { cn } from '@/lib/utils'

const STEPS = [
  { id: 0, name: 'Dimensions', shortName: '1' },
  { id: 1, name: 'Layout', shortName: '2' },
  { id: 2, name: 'Finishes', shortName: '3' },
  { id: 3, name: 'Review', shortName: '4' },
]

export function StepIndicator() {
  const { currentStep, visitedSteps } = useWizardStore()

  return (
    <div className="flex items-center justify-between px-4 py-3 bg-white border-b">
      {STEPS.map((step, index) => {
        const isActive = currentStep === step.id
        const isCompleted = visitedSteps.has(step.id) && currentStep > step.id
        const isAccessible = visitedSteps.has(step.id)

        return (
          <div key={step.id} className="flex items-center">
            {index > 0 && (
              <div className={cn(
                "w-8 h-0.5 mx-1",
                isAccessible ? "bg-zinc-900" : "bg-zinc-200"
              )} />
            )}
            <div className="flex flex-col items-center">
              <div className={cn(
                "w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",
                isActive && "bg-zinc-900 text-white",
                isCompleted && "bg-zinc-900 text-white",
                !isActive && !isCompleted && isAccessible && "border-2 border-zinc-900 text-zinc-900",
                !isAccessible && "border-2 border-zinc-300 text-zinc-300"
              )}>
                {isCompleted ? <Check className="w-4 h-4" /> : step.shortName}
              </div>
              <span className={cn(
                "text-xs mt-1",
                isActive ? "text-zinc-900 font-medium" : "text-zinc-500"
              )}>
                {step.name}
              </span>
            </div>
          </div>
        )
      })}
    </div>
  )
}
```

Create `src/components/wizard/StepNavigation.tsx`:

Per CONTEXT.md: Next/Back buttons for navigation (no swipe between steps).
- Back button disabled on Step 1
- Next button disabled if current step validation fails
- On Step 4 (Review), Next becomes "Submit" (future integration)

```typescript
import { Button } from '@/components/ui/button'
import { useWizardStore } from '@/stores/useWizardStore'
import { ChevronLeft, ChevronRight } from 'lucide-react'

export function StepNavigation() {
  const { currentStep, canProceed, nextStep, prevStep } = useWizardStore()

  const isFirstStep = currentStep === 0
  const isLastStep = currentStep === 3
  const canGoNext = canProceed(currentStep)

  return (
    <div className="flex items-center justify-between px-4 py-3 bg-white border-t">
      <Button
        variant="outline"
        onClick={prevStep}
        disabled={isFirstStep}
        className="min-w-[100px]"
      >
        <ChevronLeft className="w-4 h-4 mr-1" />
        Back
      </Button>

      <Button
        onClick={nextStep}
        disabled={!canGoNext}
        className="min-w-[100px]"
      >
        {isLastStep ? 'Submit' : 'Next'}
        {!isLastStep && <ChevronRight className="w-4 h-4 ml-1" />}
      </Button>
    </div>
  )
}
```
  </action>
  <verify>
Components render without errors.
StepIndicator shows 4 steps with correct styling.
StepNavigation buttons enable/disable correctly based on step.
  </verify>
  <done>
StepIndicator and StepNavigation components created with proper state binding.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create touch-friendly slider control component</name>
  <files>
    src/components/ui/slider-control.tsx
  </files>
  <action>
Create `src/components/ui/slider-control.tsx`:

A touch-friendly dimension slider with:
- Label (e.g., "Width")
- Current value display with unit (e.g., "2400mm")
- Slider with visible track and thumb
- Plus/minus stepper buttons for precise adjustment
- Optional min/max labels

Per requirements:
- Width: 1200-3600mm in 100mm increments
- Depth: discrete options (400, 500, 560, 600, 650mm)
- Height: 1800-2400mm in 100mm increments

```typescript
import { Slider } from '@/components/ui/slider'
import { Button } from '@/components/ui/button'
import { Minus, Plus } from 'lucide-react'

interface SliderControlProps {
  label: string
  value: number
  min: number
  max: number
  step: number
  unit?: string
  onChange: (value: number) => void
}

export function SliderControl({
  label,
  value,
  min,
  max,
  step,
  unit = 'mm',
  onChange,
}: SliderControlProps) {
  const handleDecrement = () => {
    const newValue = Math.max(min, value - step)
    onChange(newValue)
  }

  const handleIncrement = () => {
    const newValue = Math.min(max, value + step)
    onChange(newValue)
  }

  return (
    <div className="space-y-3">
      <div className="flex items-center justify-between">
        <span className="text-sm font-medium text-zinc-700">{label}</span>
        <span className="text-sm font-semibold text-zinc-900">
          {value}{unit}
        </span>
      </div>

      <div className="flex items-center gap-3">
        <Button
          variant="outline"
          size="icon"
          className="h-10 w-10 shrink-0"
          onClick={handleDecrement}
          disabled={value <= min}
        >
          <Minus className="h-4 w-4" />
        </Button>

        <Slider
          value={[value]}
          min={min}
          max={max}
          step={step}
          onValueChange={([newValue]) => onChange(newValue)}
          className="flex-1"
        />

        <Button
          variant="outline"
          size="icon"
          className="h-10 w-10 shrink-0"
          onClick={handleIncrement}
          disabled={value >= max}
        >
          <Plus className="h-4 w-4" />
        </Button>
      </div>

      <div className="flex justify-between text-xs text-zinc-500">
        <span>{min}{unit}</span>
        <span>{max}{unit}</span>
      </div>
    </div>
  )
}
```

Also create a DepthSelector component for discrete depth options:
```typescript
interface DepthSelectorProps {
  value: number
  options: number[]
  onChange: (value: number) => void
}

export function DepthSelector({ value, options, onChange }: DepthSelectorProps) {
  return (
    <div className="space-y-3">
      <span className="text-sm font-medium text-zinc-700">Depth</span>
      <div className="grid grid-cols-5 gap-2">
        {options.map((option) => (
          <button
            key={option}
            onClick={() => onChange(option)}
            className={cn(
              "py-2 px-3 rounded-md text-sm font-medium border",
              value === option
                ? "bg-zinc-900 text-white border-zinc-900"
                : "bg-white text-zinc-700 border-zinc-300 hover:border-zinc-400"
            )}
          >
            {option}
          </button>
        ))}
      </div>
      <span className="text-xs text-zinc-500">mm</span>
    </div>
  )
}
```
  </action>
  <verify>
Render SliderControl with test values.
Drag slider updates value.
Plus/minus buttons increment/decrement by step.
Buttons disable at min/max.
DepthSelector shows discrete options and highlights selection.
  </verify>
  <done>
Touch-friendly SliderControl and DepthSelector components created.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create StepDimensions and WizardShell</name>
  <files>
    src/components/wizard/StepDimensions.tsx
    src/components/wizard/WizardShell.tsx
  </files>
  <action>
Create `src/components/wizard/StepDimensions.tsx`:

Step 1: Dimension controls per requirements:
- Width slider: 1200-3600mm, 100mm increments
- Depth selector: 400, 500, 560, 600, 650mm options
- Height slider: 1800-2400mm, 100mm increments
- AI estimate pre-populated (pass as initialValues prop, default to 2400x600x2100)

```typescript
import { SliderControl, DepthSelector } from '@/components/ui/slider-control'
import { useCabinetStore } from '@/stores/useCabinetStore'
import { useThree } from '@react-three/fiber'

const DEPTH_OPTIONS = [400, 500, 560, 600, 650]

interface StepDimensionsProps {
  aiEstimate?: { width: number; depth: number; height: number }
}

export function StepDimensions({ aiEstimate }: StepDimensionsProps) {
  const dimensions = useCabinetStore((state) => state.dimensions)
  const setDimension = useCabinetStore((state) => state.setDimension)
  const { invalidate } = useThree() // Trigger 3D re-render

  const handleChange = (key: 'width' | 'depth' | 'height', value: number) => {
    setDimension(key, value)
    invalidate() // Update 3D viewport
  }

  return (
    <div className="space-y-6 p-4">
      <div>
        <h2 className="text-lg font-semibold text-zinc-900">Set Dimensions</h2>
        <p className="text-sm text-zinc-500">
          {aiEstimate
            ? 'We estimated these dimensions from your photo. Adjust as needed.'
            : 'Enter your cabinet dimensions.'}
        </p>
      </div>

      <SliderControl
        label="Width"
        value={dimensions.width}
        min={1200}
        max={3600}
        step={100}
        onChange={(v) => handleChange('width', v)}
      />

      <DepthSelector
        value={dimensions.depth}
        options={DEPTH_OPTIONS}
        onChange={(v) => handleChange('depth', v)}
      />

      <SliderControl
        label="Height"
        value={dimensions.height}
        min={1800}
        max={2400}
        step={100}
        onChange={(v) => handleChange('height', v)}
      />

      {aiEstimate && (
        <p className="text-xs text-zinc-400 text-center">
          AI estimated: {aiEstimate.width} x {aiEstimate.depth} x {aiEstimate.height}mm
        </p>
      )}
    </div>
  )
}
```

Note: StepDimensions needs to be rendered inside Canvas context to use useThree.
Alternative: Pass invalidate as prop or use zustand subscription in Canvas3D.

Create `src/components/wizard/WizardShell.tsx`:

Main wizard container that:
- Shows StepIndicator at top
- Renders current step content in middle (40% of screen per CFG-003)
- Shows StepNavigation at bottom
- Sticky bottom bar with live price (placeholder for now)

```typescript
import { useWizardStore } from '@/stores/useWizardStore'
import { StepIndicator } from './StepIndicator'
import { StepNavigation } from './StepNavigation'
import { StepDimensions } from './StepDimensions'
// Future: import { StepLayout, StepFinishes, StepReview } from './...'

interface WizardShellProps {
  aiEstimate?: { width: number; depth: number; height: number }
  onInvalidate?: () => void // Pass from Canvas3D
}

export function WizardShell({ aiEstimate, onInvalidate }: WizardShellProps) {
  const currentStep = useWizardStore((state) => state.currentStep)

  const renderStepContent = () => {
    switch (currentStep) {
      case 0:
        return <StepDimensions aiEstimate={aiEstimate} />
      case 1:
        return <div className="p-4 text-zinc-500">Layout step (Plan 05)</div>
      case 2:
        return <div className="p-4 text-zinc-500">Finishes step (Plan 07)</div>
      case 3:
        return <div className="p-4 text-zinc-500">Review step (Plan 07)</div>
      default:
        return null
    }
  }

  return (
    <div className="flex flex-col h-full bg-zinc-50">
      <StepIndicator />

      <div className="flex-1 overflow-y-auto">
        {renderStepContent()}
      </div>

      {/* Sticky price bar placeholder */}
      <div className="px-4 py-2 bg-white border-t">
        <div className="flex items-center justify-between">
          <span className="text-sm text-zinc-500">Estimated total</span>
          <span className="text-lg font-semibold text-zinc-900">$--,---</span>
        </div>
      </div>

      <StepNavigation />
    </div>
  )
}
```
  </action>
  <verify>
Render WizardShell in a test page.
StepIndicator shows Dimensions as active.
Sliders work and update values.
Next button disabled until valid dimensions set.
Clicking Next advances to Step 2 placeholder.
Back returns to Step 1.
  </verify>
  <done>
WizardShell with StepDimensions fully functional. Navigation between steps works with validation.
  </done>
</task>

</tasks>

<verification>
- StepIndicator shows 4 steps with correct state
- StepNavigation enables/disables buttons correctly
- SliderControl is touch-friendly with stepper buttons
- StepDimensions updates store and triggers 3D update
- Validation prevents Next without valid dimensions
- WizardShell renders all components together
</verification>

<success_criteria>
- 4-step wizard UI complete with navigation
- Step 1 (Dimensions) fully functional
- Validation working per requirements
- Touch-friendly controls
</success_criteria>

<output>
After completion, create `.planning/phases/04-3d-configurator-core/04-04-SUMMARY.md`
</output>
