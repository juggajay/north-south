---
phase: 06-quote-submission-flow
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/app/admin/submissions/page.tsx
  - src/components/dashboard/SubmissionQueue.tsx
  - src/components/dashboard/SubmissionCard.tsx
  - src/components/dashboard/SubmissionDetail.tsx
  - src/components/dashboard/StatusBadge.tsx
autonomous: true

must_haves:
  truths:
    - "Team can see list of all submissions ordered by date (FIFO)"
    - "Team can see customer name, email, and selected options per submission"
    - "Team can view full configuration breakdown (dimensions, modules, finishes)"
    - "Team can update submission status (New -> In Review -> Quoted)"
    - "Team can add internal notes per submission"
  artifacts:
    - path: "src/app/admin/submissions/page.tsx"
      provides: "Admin route for submission queue"
      min_lines: 30
    - path: "src/components/dashboard/SubmissionQueue.tsx"
      provides: "List of all submissions with real-time updates"
      min_lines: 60
    - path: "src/components/dashboard/SubmissionCard.tsx"
      provides: "Individual submission summary card"
      min_lines: 80
    - path: "src/components/dashboard/SubmissionDetail.tsx"
      provides: "Full config breakdown view"
      min_lines: 100
    - path: "src/components/dashboard/StatusBadge.tsx"
      provides: "Visual status indicator with colors"
      min_lines: 20
  key_links:
    - from: "src/components/dashboard/SubmissionQueue.tsx"
      to: "convex/submissions.ts"
      via: "useQuery(api.submissions.listAll)"
      pattern: "useQuery.*submissions\\.listAll"
    - from: "src/components/dashboard/SubmissionCard.tsx"
      to: "convex/submissions.ts"
      via: "useMutation(api.submissions.updateStatus)"
      pattern: "useMutation.*submissions\\.updateStatus"
---

<objective>
Build the internal team dashboard for reviewing and processing quote submissions.

Purpose: The team needs to see incoming submissions, review full configuration details, update status through the workflow (New -> In Review -> Quoted), and add internal notes. This is the "back office" for the manual quote process.

Output: Admin page at /admin/submissions with queue list, detail view, status management, and internal notes.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-quote-submission-flow/06-CONTEXT.md
@.planning/phases/06-quote-submission-flow/06-RESEARCH.md
@.planning/phases/06-quote-submission-flow/06-01-SUMMARY.md
@convex/submissions.ts
@src/components/ui/badge.tsx
@src/components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard components</name>
  <files>
src/components/dashboard/StatusBadge.tsx
src/components/dashboard/SubmissionCard.tsx
src/components/dashboard/SubmissionDetail.tsx
src/components/dashboard/SubmissionQueue.tsx
  </files>
  <action>
Create dashboard components in `src/components/dashboard/`:

**1. StatusBadge.tsx** - Visual status indicator
```typescript
"use client";

import { Badge } from "@/components/ui/badge";

type SubmissionStatus = "pending" | "in_review" | "quoted" | "ordered" | "rejected";

interface StatusBadgeProps {
  status: SubmissionStatus;
}

// Status display mapping:
// - pending: "New" (default/blue variant)
// - in_review: "In Review" (secondary/gray variant)
// - quoted: "Quoted" (success/green variant - use outline with green text if no success variant)
// - ordered: "Ordered" (purple or blue variant)
// - rejected: "Rejected" (destructive variant)

export function StatusBadge({ status }: StatusBadgeProps) {
  const config = {
    pending: { label: "New", variant: "default" as const },
    in_review: { label: "In Review", variant: "secondary" as const },
    quoted: { label: "Quoted", variant: "outline" as const, className: "text-green-600 border-green-600" },
    ordered: { label: "Ordered", variant: "secondary" as const },
    rejected: { label: "Rejected", variant: "destructive" as const },
  };

  const { label, variant, className } = config[status] || config.pending;

  return <Badge variant={variant} className={className}>{label}</Badge>;
}
```

**2. SubmissionCard.tsx** - Summary card for queue list
```typescript
"use client";

import { useState } from "react";
import { useMutation } from "convex/react";
import { api } from "../../../convex/_generated/api";
import { Card, CardHeader, CardContent, CardFooter } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { StatusBadge } from "./StatusBadge";
import { SubmissionDetail } from "./SubmissionDetail";
import { toast } from "sonner";
import { formatDistanceToNow } from "@/lib/utils"; // or use Intl.RelativeTimeFormat

interface SubmissionCardProps {
  submission: {
    _id: string;
    name: string;
    email: string;
    siteMeasure: boolean;
    installQuote: boolean;
    notes?: string;
    internalNotes?: string;
    status: string;
    createdAt: number;
    design?: {
      config: any;
      productType: string;
    };
  };
}

// Display:
// - Customer name + email
// - Submission date (relative: "2 hours ago")
// - Status badge
// - Options requested (site measure, installation)
// - Expand/collapse for full detail view
// - Status update buttons (based on current status)
// - Internal notes display and edit

// Status transitions:
// pending -> in_review (Mark as In Review)
// in_review -> quoted (Mark as Quoted)
// Any status -> rejected (Reject)
```

**3. SubmissionDetail.tsx** - Full configuration breakdown
```typescript
"use client";

import { useState } from "react";
import { useMutation } from "convex/react";
import { api } from "../../../convex/_generated/api";
import { Textarea } from "@/components/ui/textarea";
import { Button } from "@/components/ui/button";
import { toast } from "sonner";

interface SubmissionDetailProps {
  submission: {
    _id: string;
    design?: {
      config: {
        dimensions: { width: number; height: number; depth: number };
        slots: Record<string, any>; // Serialized from Map
        finishes: { material: string; hardware: string; doorProfile: string };
      };
      productType: string;
    };
    internalNotes?: string;
  };
}

// Display sections:
// 1. Dimensions (width x height x depth)
// 2. Modules breakdown (list all slots with module type, position)
// 3. Finishes (material, hardware, door profile)
// 4. Customer notes (if provided)
// 5. Internal notes section:
//    - Display existing notes
//    - Textarea for editing/adding
//    - Save button that calls updateInternalNotes mutation

export function SubmissionDetail({ submission }: SubmissionDetailProps) {
  const [internalNotes, setInternalNotes] = useState(submission.internalNotes || "");
  const [isEditing, setIsEditing] = useState(false);
  const updateNotes = useMutation(api.submissions.updateInternalNotes);

  const handleSaveNotes = async () => {
    try {
      await updateNotes({ id: submission._id, internalNotes });
      toast.success("Notes saved");
      setIsEditing(false);
    } catch (error) {
      toast.error("Failed to save notes");
    }
  };

  const config = submission.design?.config;
  if (!config) return <div>No configuration data</div>;

  // Render dimensions, modules, finishes, notes...
}
```

**4. SubmissionQueue.tsx** - Main queue list with real-time updates
```typescript
"use client";

import { useQuery } from "convex/react";
import { api } from "../../../convex/_generated/api";
import { SubmissionCard } from "./SubmissionCard";

export function SubmissionQueue() {
  // Real-time subscription - updates automatically when new submissions arrive
  const submissions = useQuery(api.submissions.listAll);

  if (submissions === undefined) {
    return (
      <div className="p-8 text-center text-zinc-500">
        Loading submissions...
      </div>
    );
  }

  if (submissions.length === 0) {
    return (
      <div className="p-8 text-center text-zinc-500">
        <p className="text-lg font-medium">No submissions yet</p>
        <p className="mt-1">Submissions will appear here when customers submit designs.</p>
      </div>
    );
  }

  // FIFO sorting handled by Convex query (order by createdAt desc)
  return (
    <div className="space-y-4">
      {submissions.map((submission) => (
        <SubmissionCard key={submission._id} submission={submission} />
      ))}
    </div>
  );
}
```

**Note on date formatting:**
Create a simple relative time formatter or use `new Date(timestamp).toLocaleDateString()` for MVP. Don't import date-fns unless already in package.json (it's not).
  </action>
  <verify>
1. Run `npm run typecheck` - no TypeScript errors
2. Files exist: `ls src/components/dashboard/`
3. Each component exports correctly
  </verify>
  <done>
- StatusBadge displays correct label and color for each status
- SubmissionCard shows summary with expand/collapse
- SubmissionDetail shows full config breakdown with internal notes editing
- SubmissionQueue lists all submissions with real-time updates
  </done>
</task>

<task type="auto">
  <name>Task 2: Create admin submissions page</name>
  <files>src/app/admin/submissions/page.tsx</files>
  <action>
Create the admin route at `src/app/admin/submissions/page.tsx`:

```typescript
"use client";

import { SubmissionQueue } from "@/components/dashboard/SubmissionQueue";

export default function AdminSubmissionsPage() {
  return (
    <div className="min-h-screen bg-zinc-50 dark:bg-zinc-900">
      <div className="max-w-4xl mx-auto p-6">
        <header className="mb-8">
          <h1 className="text-2xl font-bold text-zinc-900 dark:text-zinc-50">
            Submission Queue
          </h1>
          <p className="text-zinc-600 dark:text-zinc-400 mt-1">
            Review customer submissions and create quotes
          </p>
        </header>

        <SubmissionQueue />
      </div>
    </div>
  );
}
```

**Note:** This is an unprotected admin page for MVP. In production, you'd add auth protection (check if user is admin). For now, it's just a route that team members can access directly.

**File structure:**
```
src/app/
  admin/
    submissions/
      page.tsx    <- This file
```
  </action>
  <verify>
1. Run `npm run dev`
2. Navigate to http://localhost:3000/admin/submissions
3. Page loads showing "Submission Queue" header
4. If submissions exist, they appear in the list
5. If no submissions, empty state shows
  </verify>
  <done>
- Admin page exists at /admin/submissions
- Page shows queue header and submission list
- Real-time updates when new submissions arrive
- Status updates and internal notes work
  </done>
</task>

</tasks>

<verification>
1. TypeScript: `npm run typecheck` passes
2. Dev server: `npm run dev` works
3. Navigate to /admin/submissions - page loads
4. If submissions exist:
   - Cards display with name, email, status
   - Can expand to see full config
   - Can update status (pending -> in_review -> quoted)
   - Can add/edit internal notes
5. Real-time: Create submission from customer flow, it appears in queue immediately
</verification>

<success_criteria>
- /admin/submissions page accessible
- Queue shows all submissions in FIFO order (newest first for review)
- Each submission card shows: name, email, date, status, options requested
- Expanding a card shows full configuration details
- Team can update status through the workflow
- Team can add and save internal notes
- Real-time updates via Convex subscriptions
</success_criteria>

<output>
After completion, create `.planning/phases/06-quote-submission-flow/06-03-SUMMARY.md`
</output>
