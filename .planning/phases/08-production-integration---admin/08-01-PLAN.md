---
phase: 08-production-integration-admin
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/lib/pdf/ProductionSpecPDF.tsx
  - src/lib/pdf/sections/HeaderSection.tsx
  - src/lib/pdf/sections/CabinetSchedule.tsx
  - src/lib/pdf/sections/PanelSchedule.tsx
  - src/lib/pdf/sections/EdgeBandingSchedule.tsx
  - src/lib/pdf/sections/HardwareList.tsx
  - src/lib/pdf/styles.ts
  - src/lib/pdf/types.ts
autonomous: true

must_haves:
  truths:
    - "PDF spec renders all required sections"
    - "PDF includes header with order info"
    - "PDF includes cabinet schedule table"
    - "PDF includes panel schedule table"
    - "PDF includes hardware list table"
  artifacts:
    - path: "src/lib/pdf/ProductionSpecPDF.tsx"
      provides: "Main PDF document component"
      min_lines: 50
    - path: "src/lib/pdf/sections/CabinetSchedule.tsx"
      provides: "Cabinet schedule table section"
      exports: ["CabinetSchedule"]
    - path: "src/lib/pdf/sections/PanelSchedule.tsx"
      provides: "Panel schedule table section"
      exports: ["PanelSchedule"]
    - path: "src/lib/pdf/sections/HardwareList.tsx"
      provides: "Hardware BOM table section"
      exports: ["HardwareList"]
  key_links:
    - from: "src/lib/pdf/ProductionSpecPDF.tsx"
      to: "@react-pdf/renderer"
      via: "Document/Page/View imports"
      pattern: "import.*@react-pdf/renderer"
    - from: "src/lib/pdf/sections/*.tsx"
      to: "@ag-media/react-pdf-table"
      via: "Table/TR/TD imports"
      pattern: "import.*@ag-media/react-pdf-table"
---

<objective>
Create PDF generation infrastructure for production specifications using @react-pdf/renderer.

Purpose: Enable admin to download production specs as PDF for factory/workshop use.
Output: PDF document components with all required sections (header, cabinet schedule, panel schedule, edge banding, hardware list).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-production-integration---admin/08-RESEARCH.md

# Existing infrastructure
@convex/orders.ts
@convex/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install PDF generation libraries</name>
  <files>package.json</files>
  <action>
Install the required libraries for PDF generation:

```bash
npm install @react-pdf/renderer @ag-media/react-pdf-table
```

These libraries:
- @react-pdf/renderer: React-based PDF generation with JSX syntax
- @ag-media/react-pdf-table: Table components (Table/TR/TH/TD) for @react-pdf/renderer

IMPORTANT: Do NOT use pdfmake or jsPDF - @react-pdf/renderer is the standard for React projects per RESEARCH.md.
  </action>
  <verify>npm ls @react-pdf/renderer @ag-media/react-pdf-table shows both installed</verify>
  <done>Both libraries appear in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create PDF types and shared styles</name>
  <files>src/lib/pdf/types.ts, src/lib/pdf/styles.ts</files>
  <action>
Create types for production spec data:

**src/lib/pdf/types.ts:**
```typescript
// Types for production spec PDF generation

export interface ProductionSpecData {
  orderNumber: string;
  customerName: string;
  customerEmail: string;
  dueDate?: string;
  createdAt: string;
  cabinets: CabinetItem[];
  panels: PanelItem[];
  hardware: HardwareItem[];
  edgeBanding: EdgeBandingItem[];
  notes?: string;
}

export interface CabinetItem {
  id: string;
  type: string; // "StandardBase", "DrawerStack", etc.
  position: number; // Slot position
  width: number; // mm
  height: number; // mm
  depth: number; // mm
  interiorConfig?: string; // "3 shelves", "4 drawers", etc.
}

export interface PanelItem {
  id: string;
  name: string; // "Left Side", "Right Side", "Back", "Shelf 1", etc.
  cabinetRef: string; // Reference to parent cabinet
  width: number; // mm
  height: number; // mm
  thickness: number; // mm (typically 18)
  material: string; // Material code
  grainDirection?: "horizontal" | "vertical" | "none";
  edgeTop?: boolean;
  edgeBottom?: boolean;
  edgeLeft?: boolean;
  edgeRight?: boolean;
}

export interface HardwareItem {
  code: string;
  name: string;
  supplier: string;
  quantity: number;
  unitPrice: number; // cents
  notes?: string;
}

export interface EdgeBandingItem {
  material: string;
  thickness: string; // "0.4mm", "1mm", "2mm"
  totalLength: number; // meters
  panelCount: number; // Number of panels using this edge
}
```

**src/lib/pdf/styles.ts:**
```typescript
import { StyleSheet } from "@react-pdf/renderer";

export const styles = StyleSheet.create({
  page: {
    padding: 30,
    fontFamily: "Helvetica",
    fontSize: 9,
    backgroundColor: "#ffffff",
  },
  header: {
    marginBottom: 20,
    borderBottom: "1 solid #e4e4e7",
    paddingBottom: 15,
  },
  logo: {
    fontSize: 16,
    fontWeight: "bold",
    color: "#18181b",
    marginBottom: 5,
  },
  title: {
    fontSize: 14,
    fontWeight: "bold",
    color: "#18181b",
    marginBottom: 10,
  },
  subtitle: {
    fontSize: 10,
    color: "#71717a",
    marginBottom: 3,
  },
  section: {
    marginBottom: 15,
  },
  sectionTitle: {
    fontSize: 11,
    fontWeight: "bold",
    color: "#18181b",
    marginBottom: 8,
    paddingBottom: 3,
    borderBottom: "1 solid #e4e4e7",
  },
  tableHeader: {
    backgroundColor: "#f4f4f5",
    fontWeight: "bold",
    fontSize: 8,
  },
  tableCell: {
    padding: 4,
    fontSize: 8,
  },
  tableCellSmall: {
    padding: 3,
    fontSize: 7,
  },
  row: {
    flexDirection: "row",
    marginBottom: 3,
  },
  label: {
    width: 100,
    color: "#71717a",
  },
  value: {
    color: "#18181b",
  },
  notes: {
    marginTop: 10,
    padding: 10,
    backgroundColor: "#fefce8",
    borderRadius: 4,
    fontSize: 8,
  },
  footer: {
    position: "absolute",
    bottom: 20,
    left: 30,
    right: 30,
    fontSize: 7,
    color: "#a1a1aa",
    textAlign: "center",
  },
});
```

Use StyleSheet.create() for performance - styles are pre-computed once.
  </action>
  <verify>Files exist with no TypeScript errors: npx tsc --noEmit src/lib/pdf/types.ts src/lib/pdf/styles.ts</verify>
  <done>Types cover all production spec data, styles follow zinc color scheme</done>
</task>

<task type="auto">
  <name>Task 3: Create PDF section components and main document</name>
  <files>
    src/lib/pdf/sections/HeaderSection.tsx
    src/lib/pdf/sections/CabinetSchedule.tsx
    src/lib/pdf/sections/PanelSchedule.tsx
    src/lib/pdf/sections/EdgeBandingSchedule.tsx
    src/lib/pdf/sections/HardwareList.tsx
    src/lib/pdf/ProductionSpecPDF.tsx
  </files>
  <action>
Create each PDF section component:

**src/lib/pdf/sections/HeaderSection.tsx:**
```typescript
import { View, Text } from "@react-pdf/renderer";
import { styles } from "../styles";
import type { ProductionSpecData } from "../types";

interface HeaderSectionProps {
  data: Pick<ProductionSpecData, "orderNumber" | "customerName" | "customerEmail" | "dueDate" | "createdAt">;
}

export function HeaderSection({ data }: HeaderSectionProps) {
  return (
    <View style={styles.header}>
      <Text style={styles.logo}>North South Carpentry</Text>
      <Text style={styles.title}>Production Specification</Text>
      <View style={styles.row}>
        <Text style={styles.label}>Order Number:</Text>
        <Text style={styles.value}>{data.orderNumber}</Text>
      </View>
      <View style={styles.row}>
        <Text style={styles.label}>Customer:</Text>
        <Text style={styles.value}>{data.customerName}</Text>
      </View>
      <View style={styles.row}>
        <Text style={styles.label}>Email:</Text>
        <Text style={styles.value}>{data.customerEmail}</Text>
      </View>
      {data.dueDate && (
        <View style={styles.row}>
          <Text style={styles.label}>Due Date:</Text>
          <Text style={styles.value}>{data.dueDate}</Text>
        </View>
      )}
      <View style={styles.row}>
        <Text style={styles.label}>Generated:</Text>
        <Text style={styles.value}>{data.createdAt}</Text>
      </View>
    </View>
  );
}
```

**src/lib/pdf/sections/CabinetSchedule.tsx:**
```typescript
import { View, Text } from "@react-pdf/renderer";
import { Table, TH, TR, TD } from "@ag-media/react-pdf-table";
import { styles } from "../styles";
import type { CabinetItem } from "../types";

interface CabinetScheduleProps {
  cabinets: CabinetItem[];
}

export function CabinetSchedule({ cabinets }: CabinetScheduleProps) {
  if (cabinets.length === 0) return null;

  return (
    <View style={styles.section}>
      <Text style={styles.sectionTitle}>Cabinet Schedule</Text>
      <Table>
        <TH style={styles.tableHeader}>
          <TD style={styles.tableCell}>ID</TD>
          <TD style={styles.tableCell}>Type</TD>
          <TD style={styles.tableCell}>Position</TD>
          <TD style={styles.tableCell}>W x H x D (mm)</TD>
          <TD style={styles.tableCell}>Interior</TD>
        </TH>
        {cabinets.map((cab) => (
          <TR key={cab.id}>
            <TD style={styles.tableCell}>{cab.id}</TD>
            <TD style={styles.tableCell}>{cab.type}</TD>
            <TD style={styles.tableCell}>{cab.position}</TD>
            <TD style={styles.tableCell}>{`${cab.width} x ${cab.height} x ${cab.depth}`}</TD>
            <TD style={styles.tableCell}>{cab.interiorConfig || "-"}</TD>
          </TR>
        ))}
      </Table>
    </View>
  );
}
```

**src/lib/pdf/sections/PanelSchedule.tsx:**
```typescript
import { View, Text } from "@react-pdf/renderer";
import { Table, TH, TR, TD } from "@ag-media/react-pdf-table";
import { styles } from "../styles";
import type { PanelItem } from "../types";

interface PanelScheduleProps {
  panels: PanelItem[];
}

function formatEdges(panel: PanelItem): string {
  const edges = [];
  if (panel.edgeTop) edges.push("T");
  if (panel.edgeBottom) edges.push("B");
  if (panel.edgeLeft) edges.push("L");
  if (panel.edgeRight) edges.push("R");
  return edges.length > 0 ? edges.join(",") : "-";
}

export function PanelSchedule({ panels }: PanelScheduleProps) {
  if (panels.length === 0) return null;

  return (
    <View style={styles.section}>
      <Text style={styles.sectionTitle}>Panel Schedule</Text>
      <Table>
        <TH style={styles.tableHeader}>
          <TD style={styles.tableCellSmall}>Panel ID</TD>
          <TD style={styles.tableCellSmall}>Name</TD>
          <TD style={styles.tableCellSmall}>Cabinet</TD>
          <TD style={styles.tableCellSmall}>W x H x T</TD>
          <TD style={styles.tableCellSmall}>Material</TD>
          <TD style={styles.tableCellSmall}>Grain</TD>
          <TD style={styles.tableCellSmall}>Edges</TD>
        </TH>
        {panels.map((panel) => (
          <TR key={panel.id}>
            <TD style={styles.tableCellSmall}>{panel.id}</TD>
            <TD style={styles.tableCellSmall}>{panel.name}</TD>
            <TD style={styles.tableCellSmall}>{panel.cabinetRef}</TD>
            <TD style={styles.tableCellSmall}>{`${panel.width}x${panel.height}x${panel.thickness}`}</TD>
            <TD style={styles.tableCellSmall}>{panel.material}</TD>
            <TD style={styles.tableCellSmall}>{panel.grainDirection || "-"}</TD>
            <TD style={styles.tableCellSmall}>{formatEdges(panel)}</TD>
          </TR>
        ))}
      </Table>
    </View>
  );
}
```

**src/lib/pdf/sections/EdgeBandingSchedule.tsx:**
```typescript
import { View, Text } from "@react-pdf/renderer";
import { Table, TH, TR, TD } from "@ag-media/react-pdf-table";
import { styles } from "../styles";
import type { EdgeBandingItem } from "../types";

interface EdgeBandingScheduleProps {
  edgeBanding: EdgeBandingItem[];
}

export function EdgeBandingSchedule({ edgeBanding }: EdgeBandingScheduleProps) {
  if (edgeBanding.length === 0) return null;

  return (
    <View style={styles.section}>
      <Text style={styles.sectionTitle}>Edge Banding Summary</Text>
      <Table>
        <TH style={styles.tableHeader}>
          <TD style={styles.tableCell}>Material</TD>
          <TD style={styles.tableCell}>Thickness</TD>
          <TD style={styles.tableCell}>Total Length (m)</TD>
          <TD style={styles.tableCell}>Panel Count</TD>
        </TH>
        {edgeBanding.map((edge, idx) => (
          <TR key={idx}>
            <TD style={styles.tableCell}>{edge.material}</TD>
            <TD style={styles.tableCell}>{edge.thickness}</TD>
            <TD style={styles.tableCell}>{edge.totalLength.toFixed(2)}</TD>
            <TD style={styles.tableCell}>{edge.panelCount}</TD>
          </TR>
        ))}
      </Table>
    </View>
  );
}
```

**src/lib/pdf/sections/HardwareList.tsx:**
```typescript
import { View, Text } from "@react-pdf/renderer";
import { Table, TH, TR, TD } from "@ag-media/react-pdf-table";
import { styles } from "../styles";
import type { HardwareItem } from "../types";

interface HardwareListProps {
  hardware: HardwareItem[];
}

function formatPrice(cents: number): string {
  return new Intl.NumberFormat("en-AU", {
    style: "currency",
    currency: "AUD",
  }).format(cents / 100);
}

export function HardwareList({ hardware }: HardwareListProps) {
  if (hardware.length === 0) return null;

  const total = hardware.reduce((sum, item) => sum + item.quantity * item.unitPrice, 0);

  return (
    <View style={styles.section}>
      <Text style={styles.sectionTitle}>Hardware List (BOM)</Text>
      <Table>
        <TH style={styles.tableHeader}>
          <TD style={styles.tableCell}>Code</TD>
          <TD style={styles.tableCell}>Description</TD>
          <TD style={styles.tableCell}>Supplier</TD>
          <TD style={styles.tableCell}>Qty</TD>
          <TD style={styles.tableCell}>Unit Price</TD>
          <TD style={styles.tableCell}>Total</TD>
        </TH>
        {hardware.map((item) => (
          <TR key={item.code}>
            <TD style={styles.tableCell}>{item.code}</TD>
            <TD style={styles.tableCell}>{item.name}</TD>
            <TD style={styles.tableCell}>{item.supplier}</TD>
            <TD style={styles.tableCell}>{item.quantity}</TD>
            <TD style={styles.tableCell}>{formatPrice(item.unitPrice)}</TD>
            <TD style={styles.tableCell}>{formatPrice(item.quantity * item.unitPrice)}</TD>
          </TR>
        ))}
      </Table>
      <View style={{ marginTop: 5, alignItems: "flex-end" }}>
        <Text style={{ fontWeight: "bold", fontSize: 9 }}>
          Hardware Total: {formatPrice(total)}
        </Text>
      </View>
    </View>
  );
}
```

**src/lib/pdf/ProductionSpecPDF.tsx:**
```typescript
import { Document, Page, Text, View } from "@react-pdf/renderer";
import { styles } from "./styles";
import type { ProductionSpecData } from "./types";
import { HeaderSection } from "./sections/HeaderSection";
import { CabinetSchedule } from "./sections/CabinetSchedule";
import { PanelSchedule } from "./sections/PanelSchedule";
import { EdgeBandingSchedule } from "./sections/EdgeBandingSchedule";
import { HardwareList } from "./sections/HardwareList";

interface ProductionSpecPDFProps {
  data: ProductionSpecData;
}

export function ProductionSpecPDF({ data }: ProductionSpecPDFProps) {
  return (
    <Document>
      <Page size="A4" style={styles.page}>
        <HeaderSection data={data} />

        <CabinetSchedule cabinets={data.cabinets} />

        <PanelSchedule panels={data.panels} />

        <EdgeBandingSchedule edgeBanding={data.edgeBanding} />

        <HardwareList hardware={data.hardware} />

        {data.notes && (
          <View style={styles.notes}>
            <Text style={{ fontWeight: "bold", marginBottom: 3 }}>Notes:</Text>
            <Text>{data.notes}</Text>
          </View>
        )}

        <Text style={styles.footer}>
          Generated by North South Carpentry Production System - {data.createdAt}
        </Text>
      </Page>
    </Document>
  );
}

// Re-export types for convenience
export type { ProductionSpecData } from "./types";
```

Create an index file for clean imports:

**src/lib/pdf/index.ts:**
```typescript
export { ProductionSpecPDF } from "./ProductionSpecPDF";
export type { ProductionSpecData, CabinetItem, PanelItem, HardwareItem, EdgeBandingItem } from "./types";
```

IMPORTANT per RESEARCH.md:
- Use StyleSheet.create() for all styles (pre-computed for performance)
- All PDF components are server-safe - dynamic import with ssr:false happens at download time
- Tables use @ag-media/react-pdf-table for proper column alignment
  </action>
  <verify>npm run build passes without errors</verify>
  <done>All PDF section components created, main ProductionSpecPDF composes them</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Libraries installed:
   - `npm ls @react-pdf/renderer` shows version
   - `npm ls @ag-media/react-pdf-table` shows version

2. TypeScript compiles:
   - `npx tsc --noEmit` shows no errors in src/lib/pdf/**

3. PDF structure complete:
   - src/lib/pdf/ProductionSpecPDF.tsx exists
   - src/lib/pdf/sections/ contains all 5 section components
   - src/lib/pdf/styles.ts has shared StyleSheet
   - src/lib/pdf/types.ts has all data interfaces
</verification>

<success_criteria>
- @react-pdf/renderer and @ag-media/react-pdf-table installed
- ProductionSpecPDF component renders Document with all sections
- All section components use Table/TR/TD for tabular data
- Types cover all production spec data structures
- Build passes without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-production-integration---admin/08-01-SUMMARY.md`
</output>
