---
phase: 07-customer-portal-notifications
plan: 05
type: execute
wave: 3
depends_on: ["07-02", "07-03", "07-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Customer can see order status in timeline"
    - "Documents downloadable from portal"
    - "QR lookup works without login"
    - "Emails would send on status change (verified via scheduler)"
    - "Referral link copyable"
---

<objective>
Human verification of complete Customer Portal and Notifications system. Verify all Phase 07 features work correctly through manual testing.

Purpose: Ensure the customer portal provides the expected experience before marking phase complete.

Output: Verification confirmation that all features work as designed.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-customer-portal-notifications/07-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test data for verification</name>
  <files></files>
  <action>
    Create test data in Convex dashboard to enable verification:

    1. Create a test order from an existing submission:
       - Use Convex dashboard to run orders.create mutation
       - Pass submissionId from an existing test submission
       - Verify order created with orderNumber format NS-YYYYMMDD-XXX

    2. Update order status to trigger timeline:
       - Run orders.updateStatus mutation
       - Set status to "production"
       - Verify timeline.productionStart populated

    3. Create a test panel QR code:
       - Run panels.createPanelQr mutation
       - Pass orderId, panelId: "TEST-001", qrCode: "test-panel-001"
       - Pass moduleInfo: { name: "Base Cabinet", dimensions: { width: 600, height: 800, depth: 580 }, material: "Natural Oak", finish: "Woodmatt" }

    4. Create a test referral:
       - Get current user's ID
       - Run referrals.create mutation with referrerId, referredEmail: "test@example.com"

    Note: Document upload requires storage integration - will verify empty state for documents section.
  </action>
  <verify>
    - Test order exists in Convex dashboard
    - Order has timeline data populated
    - Test panel QR code exists
    - Test referral exists for current user
  </verify>
  <done>
    Test data created for all verification scenarios.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Customer Portal and Notifications system:
    - Order timeline with vertical stepper
    - Document section (download-only)
    - Production photos gallery
    - QR panel lookup (public)
    - Referral tracking
    - Email notification templates (6 triggers)
    - Enhanced Orders tab with navigation
  </what-built>
  <how-to-verify>
    **1. Orders Tab Experience:**
    - Navigate to Orders tab
    - Verify test order appears in list
    - Verify status badge shows correct status
    - Tap on order card â†’ should navigate to /portal/[orderId]
    - Verify referral section visible at bottom of page

    **2. Order Detail Page:**
    - On /portal/[orderId], verify:
      - Header shows order number and status
      - Timeline shows completed steps with checkmarks + timestamps
      - Current step shows expanded card with detail
      - Future steps are muted without dates
      - Documents section shows (may be empty state)
      - Photos section shows (may be empty state)
      - "Need Help?" button links to chat

    **3. QR Panel Lookup (CRITICAL - must be public):**
    - Open a new incognito/private browser window
    - Navigate to: http://localhost:3000/panel/test-panel-001
    - WITHOUT logging in, verify:
      - Page loads (no redirect to login)
      - Panel info displays: "Base Cabinet", 600x800x580mm, Natural Oak, Woodmatt
      - Minimal page design (no extra navigation)
    - Test invalid code: /panel/invalid-code-123
      - Should show "Panel Not Found" message

    **4. Referral Feature:**
    - On Orders tab, find referral section
    - Verify referral link is displayed
    - Tap "Copy Link" button
    - Verify toast shows "Link copied"
    - Verify link is in clipboard
    - Verify test referral appears in list (masked email)

    **5. Email Templates (Verify Setup):**
    - In Convex dashboard, check scheduled functions
    - If you updated order status to "production", verify:
      - Email scheduled via scheduler
      - Check notifications table for log entry
    - Review email template code for tone (professional, "Cheers" sign-off)

    **6. Mobile Responsiveness:**
    - Test all pages in mobile viewport (DevTools)
    - Verify touch targets are adequate (44px+)
    - Verify timeline is readable
    - Verify QR page is mobile-optimized
  </how-to-verify>
  <resume-signal>
    Type "approved" if all features work correctly, or describe any issues found.
  </resume-signal>
</task>

</tasks>

<verification>
Human verification checklist:
- [ ] Orders tab shows orders with navigation to details
- [ ] Timeline displays correct status progression
- [ ] Completed steps: checkmark + timestamp
- [ ] Current step: expanded with detail
- [ ] Future steps: muted, no dates
- [ ] QR lookup works WITHOUT login
- [ ] QR lookup shows correct panel info
- [ ] Invalid QR shows helpful error
- [ ] Referral link copyable
- [ ] Email scheduled on status change
- [ ] Mobile-responsive throughout
</verification>

<success_criteria>
User confirms:
- Order timeline displays correctly per CONTEXT.md decisions
- QR panel lookup is public (no login required)
- Referral system functional
- Email notifications scheduled (even if not delivered without API key)
- All UI mobile-friendly
</success_criteria>

<output>
After completion, create `.planning/phases/07-customer-portal-notifications/07-05-SUMMARY.md`
</output>
