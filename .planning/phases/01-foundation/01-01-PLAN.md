# Phase 01 Plan 1 â€” Project Setup & Convex Foundation

## Overview

Initialize the Next.js project with Capacitor, set up Convex backend, and create the core database schema.

## Prerequisites

- Node.js 20+
- npm/pnpm
- Convex account created

## Tasks

<task type="auto">
  <n>Initialize Next.js project</n>
  <files>package.json, next.config.ts, tsconfig.json, tailwind.config.ts</files>
  <action>
    Create Next.js 14 project with App Router, TypeScript, Tailwind CSS.
    
    npx create-next-app@latest nsc-app --typescript --tailwind --app --src-dir=false
    
    Configure next.config.ts for static export:
    - output: 'export'
    - images.unoptimized: true
    - trailingSlash: true
    
    Set TypeScript strict mode.
    Add path aliases for @/components, @/lib, @/hooks.
  </action>
  <verify>npm run build succeeds, outputs to 'out' directory</verify>
  <done>Next.js project builds successfully with static export</done>
</task>

<task type="auto">
  <n>Initialize Capacitor</n>
  <files>capacitor.config.ts, ios/, android/</files>
  <action>
    Install Capacitor core and CLI:
    npm install @capacitor/core @capacitor/cli
    
    Initialize Capacitor:
    npx cap init "North South Carpentry" au.com.nscarpentry.app --web-dir out
    
    Add iOS and Android platforms:
    npm install @capacitor/ios @capacitor/android
    npx cap add ios
    npx cap add android
    
    Install required plugins:
    npm install @capacitor/camera @capacitor/haptics @capacitor/keyboard @capacitor/splash-screen @capacitor/status-bar @capacitor/share @capacitor/browser @capacitor/push-notifications
  </action>
  <verify>npx cap sync succeeds, ios/ and android/ directories exist</verify>
  <done>Capacitor configured with all required plugins</done>
</task>

<task type="auto">
  <n>Set up Convex backend</n>
  <files>convex/, convex.json</files>
  <action>
    Install Convex:
    npm install convex
    
    Initialize Convex:
    npx convex init
    
    Deploy to create development environment:
    npx convex dev (run once to provision)
    
    Add NEXT_PUBLIC_CONVEX_URL to .env.local
  </action>
  <verify>npx convex dev runs without errors, dashboard shows project</verify>
  <done>Convex backend deployed and connected</done>
</task>

<task type="auto">
  <n>Create Convex schema</n>
  <files>convex/schema.ts</files>
  <action>
    Define complete database schema with all tables from REQUIREMENTS.md:
    
    Users:
    - id, email (indexed), name, phone?, address?, createdAt
    
    Designs:
    - id, userId, productType, config (any), status, renders[], createdAt, updatedAt
    - Index by userId
    
    Submissions:
    - id, designId, name, email, siteMeasure (bool), installQuote (bool), status, createdAt
    
    Orders:
    - id, submissionId, status, depositPaid, balanceDue, timeline, createdAt
    
    ProductionPhotos:
    - id, orderId, storageId, milestone, uploadedAt
    
    Notifications:
    - id, orderId, type, channel, sentAt, status
    
    Product definition tables (seed data):
    - styles, materials, hardware, doorProfiles, products, modules, addons
  </action>
  <verify>npx convex dev shows schema deployed, no errors</verify>
  <done>Complete database schema deployed to Convex</done>
</task>

<task type="auto">
  <n>Create seed data functions</n>
  <files>convex/seed.ts, convex/products/materials.ts, convex/products/hardware.ts</files>
  <action>
    Create seed functions to populate product catalog:
    
    Materials (from PRD):
    - POL-NOWM: Natural Oak Woodmatt
    - POL-PRWM: Prime Oak Woodmatt
    - POL-COWM: Coastal Oak Woodmatt
    - POL-WOWM: White Oak Woodmatt
    - POL-BLWM: Blackbutt Woodmatt
    - POL-WHST: White Satin
    - POL-SHGR: Shadow Grey
    - POL-MNTK: Midnight
    
    Hardware (from PRD):
    - BLUM-CLIP-110, BLUM-CLIP-155, BLUM-TANDEM-450/500/550
    - BLUM-LEGRA-500, BLUM-SPACE-600, BLUM-AVENTOS-HK
    
    Door Profiles:
    - Flat Panel, Slimline Shaker, Traditional Shaker, Fluted/Reeded
    
    Module Types:
    - 7 base types, 5 overhead types per REQUIREMENTS
    
    Add-ons:
    - LED Strip ($45), Scribe Filler ($35), Wine Rack ($120), etc.
    
    Create runSeed mutation for one-time population.
  </action>
  <verify>Run seed function, query materials/hardware returns expected data</verify>
  <done>Product catalog seeded with all materials, hardware, modules, add-ons</done>
</task>

<task type="auto">
  <n>Set up Convex Auth</n>
  <files>convex/auth.ts, convex/auth.config.ts</files>
  <action>
    Configure Convex Auth for email/password and magic links:
    
    npm install @convex-dev/auth
    
    Create auth.config.ts with:
    - Email/password provider
    - Magic link provider (via Resend)
    - Session duration: 30 days
    
    Create auth.ts with signIn, signOut, getUser functions.
    
    Add Resend API key to Convex environment variables.
    
    Create useAuth hook for frontend.
  </action>
  <verify>Can create account, login, logout via Convex functions</verify>
  <done>Authentication working with email/password and magic links</done>
</task>

<task type="auto">
  <n>Create base Convex queries and mutations</n>
  <files>convex/designs.ts, convex/users.ts, convex/submissions.ts</files>
  <action>
    Designs:
    - create: Create new design
    - update: Update design config
    - get: Get single design by ID
    - listByUser: Get all designs for user
    - updateStatus: Change design status
    
    Users:
    - getOrCreate: Get user by email or create new
    - update: Update user profile
    
    Submissions:
    - create: Submit design for quote
    - listPending: Get unprocessed submissions (internal)
    - updateStatus: Mark as quoted/ordered
    
    All queries must be type-safe with proper validators.
  </action>
  <verify>All queries/mutations callable from frontend, types inferred correctly</verify>
  <done>Core Convex API layer complete</done>
</task>

<task type="auto">
  <n>Create app layout and routing structure</n>
  <files>app/layout.tsx, app/(tabs)/layout.tsx, app/(tabs)/home/page.tsx</files>
  <action>
    Root layout:
    - ConvexProvider wrapping app
    - PostHog analytics init
    - Global styles
    - Metadata (title, description, icons)
    
    Tab layout:
    - Bottom navigation component
    - Tab switching animation
    - Active tab indicator
    
    Create placeholder pages:
    - app/(tabs)/home/page.tsx
    - app/(tabs)/design/page.tsx
    - app/(tabs)/orders/page.tsx
    - app/(tabs)/chat/page.tsx
    
    Each page should render a simple "Coming soon" placeholder.
  </action>
  <verify>App runs, can navigate between all 4 tabs</verify>
  <done>App shell with tab navigation working</done>
</task>

<task type="auto">
  <n>Create base UI components</n>
  <files>components/ui/button.tsx, components/ui/sheet.tsx, components/ui/input.tsx</files>
  <action>
    Build base components following shadcn/ui patterns:
    
    Button:
    - Variants: primary, secondary, outline, ghost
    - Sizes: sm, md, lg
    - Loading state with spinner
    - Disabled state
    
    BottomSheet:
    - Framer Motion animation
    - Drag to dismiss
    - Snap points (25%, 50%, 85%)
    - Backdrop click to close
    - Handle indicator
    
    Input:
    - Text, email, tel types
    - Error state
    - Label and helper text
    - Focus ring
    
    All components must meet 44x44px touch target minimum.
  </action>
  <verify>Components render correctly, touch targets verified in inspector</verify>
  <done>Base UI component library established</done>
</task>

<task type="auto">
  <n>Configure CI/CD pipeline</n>
  <files>.github/workflows/lint-test.yml, .github/workflows/deploy-preview.yml</files>
  <action>
    Create GitHub Actions workflows:
    
    lint-test.yml (on PR):
    - Install dependencies
    - Run ESLint
    - Run TypeScript check
    - Run Vitest tests
    
    deploy-preview.yml (on PR):
    - Build Next.js
    - Deploy to Vercel preview
    - Comment with preview URL
    
    Add Vercel project connection:
    - vercel link
    - Add VERCEL_TOKEN to GitHub secrets
    
    Add Convex deploy:
    - npx convex deploy in CI
    - Add CONVEX_DEPLOY_KEY to secrets
  </action>
  <verify>Push PR, workflows run, preview deployed</verify>
  <done>CI/CD pipeline operational</done>
</task>

## Wave Execution

**Wave 1 (Parallel):**
- Initialize Next.js project
- Set up Convex backend

**Wave 2 (Sequential after Wave 1):**
- Initialize Capacitor
- Create Convex schema

**Wave 3 (Sequential after Wave 2):**
- Create seed data functions
- Set up Convex Auth

**Wave 4 (Sequential after Wave 3):**
- Create base Convex queries and mutations
- Create app layout and routing structure

**Wave 5 (Sequential after Wave 4):**
- Create base UI components
- Configure CI/CD pipeline

## Verification

After all tasks complete:

1. `npm run build` produces static export
2. `npx cap sync` succeeds for iOS and Android
3. `npx convex dev` shows all tables
4. Can create user, save design, retrieve design
5. Tab navigation works on web
6. CI/CD runs on push
