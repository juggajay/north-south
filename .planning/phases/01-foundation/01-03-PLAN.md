---
phase: 01-foundation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - public/manifest.json
  - public/icons/icon-192x192.png
  - public/icons/icon-512x512.png
  - public/apple-touch-icon.png
  - src/app/layout.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "App can be installed as PWA on mobile browsers"
    - "PWA prompt appears when visiting site on mobile"
    - "Installed PWA launches in standalone mode"
    - "App has proper icons on home screen"
  artifacts:
    - path: "public/manifest.json"
      provides: "PWA manifest with app metadata"
      contains: "display.*standalone"
    - path: "public/icons/icon-192x192.png"
      provides: "PWA icon for Android"
    - path: "public/icons/icon-512x512.png"
      provides: "PWA icon for splash screen"
    - path: "public/apple-touch-icon.png"
      provides: "iOS home screen icon"
  key_links:
    - from: "src/app/layout.tsx"
      to: "public/manifest.json"
      via: "metadata.manifest"
      pattern: 'manifest.*"/manifest.json"'
    - from: "public/manifest.json"
      to: "public/icons/"
      via: "icons array"
      pattern: '"src".*icons/'
---

<objective>
Add PWA manifest and icons to close Gap 2 from verification.

Purpose: The layout.tsx references /manifest.json and PWA icons but these files don't exist. This prevents the app from being installable as a PWA on mobile browsers.

Output: Complete PWA manifest with proper metadata and icons that enable "Add to Home Screen" functionality on both iOS and Android.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

# Layout already references manifest (verify existing metadata)
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PWA manifest.json</name>
  <files>public/manifest.json</files>
  <action>
Create public/manifest.json with the following configuration:

```json
{
  "name": "North South Carpentry",
  "short_name": "NSC",
  "description": "Design your dream kitchen, laundry, vanity or wardrobe",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#ffffff",
  "orientation": "portrait-primary",
  "scope": "/",
  "icons": [
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ],
  "categories": ["lifestyle", "utilities"],
  "screenshots": []
}
```

Key requirements:
- display: "standalone" for app-like experience
- orientation: "portrait-primary" since this is mobile-first
- Icons with "maskable" purpose for adaptive icons on Android
- start_url: "/" to launch to home tab
  </action>
  <verify>
File exists: `ls public/manifest.json`
Valid JSON: `node -e "require('./public/manifest.json')"`
Has required fields: grep for "display.*standalone" and "icons"
  </verify>
  <done>public/manifest.json exists with complete PWA configuration</done>
</task>

<task type="auto">
  <name>Task 2: Create PWA icons</name>
  <files>
public/icons/icon-192x192.png
public/icons/icon-512x512.png
public/apple-touch-icon.png
  </files>
  <action>
Create PWA icon files. Since we cannot generate actual images, create placeholder SVG-based PNGs using a simple approach:

**Option 1 (preferred): Use ImageMagick if available**
```bash
mkdir -p public/icons
# Create simple branded placeholder icons
convert -size 192x192 xc:#18181b -fill white -gravity center -pointsize 48 -annotate 0 "NSC" public/icons/icon-192x192.png
convert -size 512x512 xc:#18181b -fill white -gravity center -pointsize 128 -annotate 0 "NSC" public/icons/icon-512x512.png
convert -size 180x180 xc:#18181b -fill white -gravity center -pointsize 48 -annotate 0 "NSC" public/apple-touch-icon.png
```

**Option 2: Download placeholder icons**
If ImageMagick not available, download simple solid-color PNG placeholders:
- Use a minimal PNG generator or create base64-encoded minimal PNGs

**Option 3: Create minimal valid PNGs programmatically**
Create a simple Node script that generates minimal valid PNG files:
```javascript
// scripts/generate-icons.js
const fs = require('fs');
const { createCanvas } = require('canvas'); // or use sharp
// Generate solid color icons with text
```

The icons should:
- Use zinc-900 (#18181b) as background (matches app theme)
- Have "NSC" text centered in white
- Be proper PNG format
- apple-touch-icon.png should be 180x180 for iOS

If none of these work, create the directory structure and add a TODO comment in a placeholder file, but the manifest must still reference the correct paths.
  </action>
  <verify>
Directory exists: `ls -la public/icons/`
Icon files exist: `ls public/icons/*.png public/apple-touch-icon.png`
Files are valid images (non-zero size): `ls -la public/icons/*.png | awk '{print $5}'` shows size > 0
  </verify>
  <done>PWA icons exist at public/icons/icon-192x192.png, icon-512x512.png, and public/apple-touch-icon.png</done>
</task>

<task type="auto">
  <name>Task 3: Verify layout.tsx icon references</name>
  <files>src/app/layout.tsx</files>
  <action>
Check and update src/app/layout.tsx to ensure icon paths match created files.

The current layout.tsx has:
```tsx
icons: {
  icon: "/favicon.ico",
  apple: "/apple-touch-icon.png",
},
```

Verify this matches the created apple-touch-icon.png location (public/apple-touch-icon.png).

If there's no favicon.ico, either:
1. Create a simple favicon.ico from the icon
2. Or update the icon reference to use a PNG: `icon: "/icons/icon-192x192.png"`

Also ensure manifest reference is correct:
```tsx
manifest: "/manifest.json",
```

This should already be correct but verify it matches the created file location.
  </action>
  <verify>
Manifest reference: `grep 'manifest.*manifest.json' src/app/layout.tsx`
Apple icon reference: `grep 'apple.*apple-touch-icon' src/app/layout.tsx`
Run `npm run build` to verify no broken references
  </verify>
  <done>layout.tsx icon and manifest references match created files</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build check: `npm run build` completes without warnings about missing manifest/icons
2. Manifest valid: `node -e "console.log(require('./public/manifest.json'))"` outputs valid JSON
3. Files exist:
   - `ls public/manifest.json`
   - `ls public/icons/icon-192x192.png`
   - `ls public/icons/icon-512x512.png`
   - `ls public/apple-touch-icon.png`
4. Manifest has required PWA fields: display, start_url, icons array
</verification>

<success_criteria>
- [ ] public/manifest.json exists with valid PWA configuration
- [ ] display: "standalone" in manifest
- [ ] icons array references existing PNG files
- [ ] public/icons/icon-192x192.png exists (non-zero size)
- [ ] public/icons/icon-512x512.png exists (non-zero size)
- [ ] public/apple-touch-icon.png exists (180x180)
- [ ] layout.tsx references match actual file locations
- [ ] npm run build succeeds without manifest/icon warnings
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
