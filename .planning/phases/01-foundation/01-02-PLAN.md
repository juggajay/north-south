---
phase: 01-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/convex.tsx
  - src/app/(auth)/login/page.tsx
  - src/components/auth/LoginForm.tsx
  - src/components/auth/RegisterForm.tsx
  - src/components/auth/LogoutButton.tsx
  - src/app/(tabs)/layout.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can view login page at /login"
    - "User can register with email and password"
    - "User can login with email and password"
    - "User can logout from the app"
    - "Authenticated state persists across page navigation"
  artifacts:
    - path: "src/app/(auth)/login/page.tsx"
      provides: "Login page route"
      min_lines: 20
    - path: "src/components/auth/LoginForm.tsx"
      provides: "Login form with email/password fields"
      min_lines: 50
    - path: "src/components/auth/RegisterForm.tsx"
      provides: "Registration form with email/password/confirm fields"
      min_lines: 50
    - path: "src/components/auth/LogoutButton.tsx"
      provides: "Logout button component"
      min_lines: 15
    - path: "src/lib/convex.tsx"
      provides: "Convex provider with ConvexAuthProvider"
      contains: "ConvexAuthProvider"
  key_links:
    - from: "src/components/auth/LoginForm.tsx"
      to: "convex/auth.config.ts"
      via: "useAuthActions signIn"
      pattern: "signIn.*password"
    - from: "src/components/auth/LogoutButton.tsx"
      to: "convex/auth.config.ts"
      via: "useAuthActions signOut"
      pattern: "signOut"
    - from: "src/lib/convex.tsx"
      to: "@convex-dev/auth/react"
      via: "ConvexAuthProvider import"
      pattern: "ConvexAuthProvider"
---

<objective>
Add authentication UI components to close Gap 1 from verification.

Purpose: The auth backend (convex/auth.config.ts, convex/auth.ts) is fully implemented but users cannot register, login, or logout because there are no UI components. This plan creates the frontend authentication interface.

Output: Login page, registration form, logout button, and auth provider integration that connects to the existing Convex auth backend.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

# Existing auth backend (DO NOT modify these)
@convex/auth.config.ts
@convex/auth.ts
@src/hooks/useAuth.ts

# Files to modify/extend
@src/lib/convex.tsx
@src/components/ui/button.tsx
@src/components/ui/input.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ConvexAuthProvider to app provider</name>
  <files>src/lib/convex.tsx</files>
  <action>
Update the ConvexClientProvider to include ConvexAuthProvider from @convex-dev/auth/react.

The ConvexAuthProvider must wrap children inside ConvexProvider:

```tsx
import { ConvexAuthProvider } from "@convex-dev/auth/react";

// Inside ConvexClientProvider return:
return (
  <BaseConvexProvider client={convex}>
    <ConvexAuthProvider client={convex}>
      {children}
    </ConvexAuthProvider>
  </BaseConvexProvider>
);
```

This enables useAuthActions() hook throughout the app for signIn/signOut operations.
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors related to convex.tsx
Grep for ConvexAuthProvider in the file confirms it's present
  </verify>
  <done>ConvexClientProvider includes ConvexAuthProvider wrapper</done>
</task>

<task type="auto">
  <name>Task 2: Create auth components (LoginForm, RegisterForm, LogoutButton)</name>
  <files>
src/components/auth/LoginForm.tsx
src/components/auth/RegisterForm.tsx
src/components/auth/LogoutButton.tsx
  </files>
  <action>
Create three auth components in src/components/auth/:

**LoginForm.tsx:**
- Form with email and password fields using existing Input component
- Submit button using existing Button component with loading state
- Uses useAuthActions() from @convex-dev/auth/react to call signIn("password", { email, password, flow: "signIn" })
- Error handling with toast or inline error message
- Link to switch to register mode (prop: onSwitchToRegister callback)
- Mobile-friendly: 44px touch targets, full-width inputs

**RegisterForm.tsx:**
- Form with email, password, and confirm password fields
- Client-side validation: password match, minimum length (8 chars)
- Uses signIn("password", { email, password, flow: "signUp" }) for registration
- Error handling for existing email, weak password etc.
- Link to switch to login mode (prop: onSwitchToLogin callback)

**LogoutButton.tsx:**
- Simple button component that calls signOut() from useAuthActions()
- Loading state while signing out
- Optional: variant prop to match UI context (e.g., "ghost" for nav, "destructive" for settings)

All components should use existing UI components (Button, Input) from src/components/ui/.
  </action>
  <verify>
Files exist: ls src/components/auth/*.tsx shows 3 files
Run `npx tsc --noEmit` - no type errors
Grep "useAuthActions" in auth components confirms hook usage
  </verify>
  <done>LoginForm, RegisterForm, LogoutButton components created with proper Convex auth integration</done>
</task>

<task type="auto">
  <name>Task 3: Create login page and add logout to navigation</name>
  <files>
src/app/(auth)/login/page.tsx
src/app/(tabs)/layout.tsx
  </files>
  <action>
**Create login page at src/app/(auth)/login/page.tsx:**
- Route group (auth) keeps login outside of tabs layout
- Page toggles between LoginForm and RegisterForm based on state
- Redirect to / if already authenticated (check with useAuth hook)
- Mobile-optimized layout: centered card, logo at top, safe area padding
- "use client" directive for interactivity

**Update src/app/(tabs)/layout.tsx:**
- Import LogoutButton component
- Add logout button to header/top area (not bottom nav)
- Only show logout when user is authenticated (use useAuth hook)
- Position in top-right corner or as part of a user menu
- Keep existing BottomNav unchanged

Do NOT modify BottomNav.tsx - keep navigation tabs as-is.
  </action>
  <verify>
Run `npm run dev` and visit http://localhost:3000/login - page loads without error
Check that (tabs)/layout.tsx includes LogoutButton import
Run `npx tsc --noEmit` - no type errors
  </verify>
  <done>Login page exists at /login, logout button appears in tabs layout for authenticated users</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build check: `npm run build` completes without errors
2. Type check: `npx tsc --noEmit` passes
3. Route exists: `ls src/app/\(auth\)/login/page.tsx` shows file
4. Components exist: `ls src/components/auth/` shows LoginForm.tsx, RegisterForm.tsx, LogoutButton.tsx
5. Provider updated: `grep "ConvexAuthProvider" src/lib/convex.tsx` shows import and usage
</verification>

<success_criteria>
- [ ] ConvexAuthProvider wraps app in src/lib/convex.tsx
- [ ] LoginForm component uses useAuthActions signIn with "password" provider
- [ ] RegisterForm component uses signIn with flow: "signUp"
- [ ] LogoutButton component uses useAuthActions signOut
- [ ] /login route renders login/register forms
- [ ] Tabs layout shows logout button for authenticated users
- [ ] All files type-check without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
